<div data-ng-controller="createStockAdjustmentController"
	data-ng-init="fetchInitData()">

	<section class="content-header">
		<h1>
			<i class="fa fa-cube"></i> Stock Adjustment
		</h1>
		<ol class="breadcrumb">
			<li><a href="" data-ng-click="appRouting('dashboard')"><i
					class="fa fa-dashboard"></i> Home</a></li>
			<li><a class="active">Initiate Stock Adjustment</a></li>
		</ol>
	</section>

	<section class="invoice">
		<form name="orderForm" class="form-horizontal"
			data-ng-submit="saveOrder(orderForm.$valid)" novalidate>
			<div class="row">

				<div class="col-lg-4 col-md-4 col-xs-12">
					<div class="box box-primary">
						<div class="box-header with-border">
							<h2 class="box-title">Warehouse</h2>
						</div>
						<!-- /.box-header -->
						<div class="box-body">
							<div class="form-group"
								data-ng-class="{ 'has-error' : orderForm.warehouse.$invalid && orderForm.warehouse.$touched }">
								<div class="col-sm-10">
									<input type="text" class="form-control" data-ng-model="order.warehouse.name" data-ng-if="isUpdate" readonly="readonly" />
									<ui-select ng-model="order.warehouse" data-ng-required="true" data-ng-if="!isUpdate"
										data-ng-change="warehouseSelectEvent()"
										name="warehouse"> <ui-select-match
										placeholder="Select Warehouse..."> <span
										ng-bind="$select.selected.name"></span> </ui-select-match> <ui-select-choices
										repeat="warehouse as warehouse in (listOfWarehouses | filter: $select.search) track by warehouse.id">
									<span ng-bind="warehouse.name"></span> </ui-select-choices> </ui-select>
									<p
										data-ng-show="orderForm.warehouse.$invalid && orderForm.warehouse.$touched"
										class="help-block">Which Warehouse the items need to be
										adjusted?</p>
								</div>
							</div>
							<!-- /.form-group -->
						</div>
						<!-- /.box-body -->

						<!-- /.box-footer -->
					</div>
					<!-- /.box -->
				</div>
				<!-- /.col -->

				<div class="col-lg-4 col-md-4 col-xs-12"></div>
				<!-- /.col -->

				<div class="col-lg-4 col-md-4 col-xs-12">
					<div class="box box-primary">
						<div class="box-header with-border">
							<h2 class="box-title">Order Details</h2>
						</div>
						<!-- /.box-header -->
						<div class="box-body">
							<div class="form-group">
								<label for="orderNo" class="col-sm-3 control-label">SA #</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="orderNo"
										data-ng-model="order.orderNumber"
										placeholder="Autogenerated once the order is saved!"
										readonly="readonly">
								</div>
							</div>
							<div class="form-group">
								<label for="date" class="col-sm-3 control-label">Date</label>
								<div class="col-sm-9">
									<input type="text" class="form-control date" name="date"
										data-ng-model="order.orderDate" readonly="readonly">
								</div>
							</div>
							<div class="form-group">
								<label for="status" class="col-sm-3 control-label">Status</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" id="status"
										data-ng-model="order.status"
										placeholder="Autoupdated once the order is updated!"
										readonly="readonly">
								</div>
							</div>
						</div>
						<!-- /.box-body -->

						<!-- /.box-footer -->
					</div>
					<!-- /.box -->
				</div>
				<!-- /.col -->
			</div>

			<div class="row">
				<div class="col-xs-12">
					<div class="box box-primary">
						<div class="box-header">
							<h3 class="box-title">SA Items</h3>
							<div class="box-tools">
								<button type="button" class="btn btn-warning" data-ng-disabled="!order.warehouse"
									data-ng-click="getItemDetails()" data-ng-if="!isUpdate">Add
									Items to Adjust</button>
							</div>
						</div>
						<div class="box-body table-responsive">
							<table class="table table-bordered table-condensed"
								data-ng-model="order.items">
								<thead>
									<tr>
										<th class="col-md-4">Code</th>
										<th class="col-md-4">Barcode Serial</th>
										<th class="col-md-2">Quantity Adjusted</th>
									</tr>
								</thead>
								<tbody>
									<tr ng-repeat="item in order.items">
										<td>{{item.item.code}}</td>
										<td>{{item.barcode}}</td>
										<td>{{item.quantityDelivered}}</td>
									</tr>
								</tbody>
							</table>
						</div>
						<!-- /.box-body -->
					</div>
					<!-- /.box -->
				</div>
				<!-- /.col -->
			</div>

			<div class="row" data-ng-if="!isUpdate">
				<div class="col-xs-12 col-lg-offset-5 col-md-offset-4">
					<div class="btn-groupbtn-group-justified" role="group">
						<div class="btn-group" role="group">
							<button type="submit" class="btn btn-success update"
								data-ng-disabled="orderForm.$invalid || order.items.length == 0"
								data-ng-show="!isUpdate">Adjust!</button>
						</div>
					</div>
				</div>
			</div>


		</form>
	</section>


	<div class="modal" id="getAdjustmentModal">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">Add Items to Delivery</h4>
				</div>
				<div class="modal-body">
					<form role="form">
						<div class="box-body">
							<div class="row">
								<div class="col-xs-12">
									<label for="code">Code (Search by Item code, barcode,
										tag)</label>
									<ui-select ng-model="$parent.selectedItem"
										data-ng-change="itemSelectEvent()"> <ui-select-match
										placeholder="type atleast 3 characters to search..">
									<span ng-bind="$select.selected.code"></span> </ui-select-match> <ui-select-choices
										repeat="item as item in (listOfItems | filter: $select.search) track by item.id"
										refresh="fetchRemoteItems($select.search)" refresh-delay="0">
									<span ng-bind="item.code +'-'+ item.description"></span> </ui-select-choices> </ui-select>
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<label for="existingQuantity">Existing Quantity
										Ordered</label> <input type="text" class="form-control"
										id="existingQuantity" data-ng-model="existingQuantity"
										readonly="readonly">
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<label for="updatedQuantity">New Quantity</label> 
										<input type="text" class="form-control"	data-ng-change="itemQuantityEvent()"
										id="updatedQuantity" data-ng-model="updatedQuantity">
								</div>
							</div>
							<div class="row">
								<div class="col-xs-12">
									<label for="adjustment">Adjustment</label>
									 <input type="text" class="form-control"
										id="adjustment" data-ng-model="adjustment" readonly="readonly">
								</div>
							</div>
							
							<div class="row" data-ng-if="getSerialNumbers"
								data-ng-repeat="serializedItem in listOfSerializedItems track by $index">
								<div class="col-xs-12">
									<label for="vendorId">Serial {{$index + 1}}</label> <input
										type="text" class="form-control" id="vendorId"
										data-ng-model="listOfSerializedItems[$index]"
										placeholder="Vendor Serial #">
								</div>

							</div>
						</div>
						<!-- /.box-body -->
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger pull-left"
						data-dismiss="modal" id="close">Close</button>
					<button type="button" id="submit" class="btn btn-success"
						data-ng-click="addItemToOrder()">Save changes</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>

</div>
<div class="clearfix"></div>

<script type="text/javascript">
	$(document).ready(function() {
		$('.date').daterangepicker({
			singleDatePicker : true,
			showDropdowns : true,
			format : 'YYYY-MM-DD'
		});
		//$(".select2").select2();
	});
</script>